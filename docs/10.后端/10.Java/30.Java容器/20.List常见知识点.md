---
title: Listå¸¸è§çŸ¥è¯†ç‚¹
date: 2022-07-13 16:28:42
permalink: /pages/db1d18/
categories:
  - Java
  - Javaå®¹å™¨
tags:
  - 
author: 
  name: Marvel
  link: https://github.com/zouquchen
---
# Listå¸¸è§çŸ¥è¯†ç‚¹

## å¸¸è§çš„Listå®ç°ç±»

<img src="https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/list-relation.png" alt="image-20220716211838484" style="zoom:67%;" />

| å®ç°ç±»               | çº¿ç¨‹å®‰å…¨ | æ•ˆç‡                             | åº•å±‚å®ç° |
| -------------------- | -------- | -------------------------------- | -------- |
| Vector               | å®‰å…¨     | æ•ˆç‡ä½                           | æ•°ç»„     |
| ArrayList            | ä¸å®‰å…¨   | æŸ¥æ‰¾æ•ˆç‡é«˜ï¼Œæ’å…¥åˆ é™¤æ•ˆç‡ä½       | æ•°ç»„     |
| LinkedList           | ä¸å®‰å…¨   | æŸ¥æ‰¾æ•ˆç‡ä½ï¼Œæ’å…¥åˆ é™¤æ•ˆç‡ä½       | é“¾è¡¨     |
| CopyOnWriteArrayList | å®‰å…¨     | æ€§èƒ½ä¼˜äºVectorï¼Œè¯»ä¸åŠ é”ï¼Œå†™åŠ é” | æ•°ç»„     |

## ArrayListå’ŒVectorçš„åŒºåˆ«

- ArrayList æ˜¯ List çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ `Object[] `å­˜å‚¨ï¼Œé€‚åˆäºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ã€‚
- Vector æ˜¯ List çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ `Object[]` å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ã€‚

## ArrayListå’ŒLinkedListåŒºåˆ«

- çº¿ç¨‹å®‰å…¨ï¼šéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚
- åº•å±‚æ•°æ®ç»“æ„ï¼šArrayList ä½¿ç”¨çš„æ˜¯ Object æ•°ç»„ï¼›LinkedList ä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨
- æ’å…¥å’Œåˆ é™¤ï¼šArrayList æ’å…¥å’Œåˆ é™¤æ…¢ï¼ŒLinkedListæ’å…¥å’Œåˆ é™¤å¿«ã€‚
- éšæœºè®¿é—®ï¼šArrayList æ”¯æŒéšæœºè®¿é—®ï¼ŒLInkedListä¸æ”¯æŒ
- å†…å­˜å ç”¨ï¼šLinkedList å ç”¨ç©ºé—´å¤šä½™ ArrayList

## Vectorå’ŒCopyOnWriteArrayListåŒºåˆ«

- éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåº•å±‚å®ç°éƒ½æ˜¯æ•°ç»„ã€‚
- Vector çš„æ¯ä¸ªæ–¹æ³•éƒ½è¿›è¡Œäº†åŠ é”ã€‚
- CopyOnWriteArrayList çš„è¯»æ“ä½œä¸åŠ é”ï¼Œæ€§èƒ½ä¼˜äº Vectorã€‚
- CopyOnWriteArrayList çš„å†™æ“ä½œï¼šåŠ é”ã€å¤åˆ¶æ•°ç»„ã€æ·»åŠ å…ƒç´ åˆ°å¤åˆ¶æ•°ç»„ã€æŒ‡å‘æ–°æ•°ç»„ã€è§£é”

::: note å†™æ—¶å¤åˆ¶æŠ€æœ¯

CopyOnWriteï¼ˆCOWï¼‰ï¼Œå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œå½“å¤§å®¶å…±åŒå»è®¿é—®ä¸€ä¸ªèµ„æºæ—¶ï¼Œå¦‚æœæœ‰äººæƒ³è¦å»ä¿®æ”¹è¿™ä¸ªèµ„æºçš„æ—¶å€™ï¼Œå°±éœ€è¦å¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ï¼Œå»ä¿®æ”¹è¿™ä¸ªå‰¯æœ¬ï¼Œè€Œå¯¹äºå…¶ä»–äººæ¥è¯´è®¿é—®å¾—èµ„æºè¿˜æ˜¯åŸæ¥çš„ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚

::: 

## ArrayListçš„å¹¶å‘å¼‚å¸¸
âŒ¨ **è¿è¡Œä»¥ä¸‹ä»£ç **

åœºæ™¯1: ä½¿ç”¨ forEach éå†æ—¶æ·»åŠ æ–°å…ƒç´ 
```java
public class ArrayListForModifyTest {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        // åˆ›å»º30ä¸ªçº¿ç¨‹å‘listç§æ·»åŠ å…ƒç´ 
        for (int i = 0; i < 30; i++) {
            list.add(UUID.randomUUID().toString().substring(0, 8));
        }

        list.forEach(e -> {
            System.out.println(e);
            list.add(UUID.randomUUID().toString().substring(0, 8));
        });
    }
}
```

åœºæ™¯2: å¤šçº¿ç¨‹æ·»åŠ å…ƒç´ 
```java
public class ArrayListJucTest {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        // åˆ›å»º30ä¸ªçº¿ç¨‹å‘listç§æ·»åŠ å…ƒç´ 
        for (int i = 0; i < 30; i++) {
            new Thread(() -> {
                list.add(UUID.randomUUID().toString().substring(0, 8));
                System.out.println(list);
            }, String.valueOf(i)).start();
        }
    }
}

```

ğŸ—‘ **å‡ºç°å¼‚å¸¸**ï¼šå¹¶å‘ä¿®æ”¹å¼‚å¸¸

```
java.util.ConcurrentModificationException
```

ğŸ“£ **å¯¼è‡´åŸå› **

å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰

ğŸ· **è§£å†³æ–¹æ¡ˆï¼ˆé’ˆå¯¹äºåœºæ™¯1ï¼‰**

1 ä½¿ç”¨ Vectorï¼ˆè¿œå¤å®ç°ç±»ï¼Œä¸æ¨èï¼‰

```java
List<String> list = new Vector<>();
```

2 ä½¿ç”¨çº¿ç¨‹å®‰å…¨å·¥å…·ç±»

```java
List<String> list = Collections.synchronizedList(new ArrayList<>());
```

3 ä½¿ç”¨ CopyOnWriteArrayList ï¼ˆå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼‰

```java
List<String> list = new CopyOnWriteArrayList<>();
```

## å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰

æ˜¯ Java é›†åˆçš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚åœ¨ä½¿ç”¨è¿­ä»£å™¨å¯¹é›†åˆè¿›è¡Œéå†çš„æ—¶å€™ï¼Œåœ¨å¤šçº¿ç¨‹æ“ä½œä¸‹ï¼Œé›†åˆå¯èƒ½ä¼šè§¦å‘ fail-fast æœºåˆ¶ï¼Œå¯¼è‡´æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼›åœ¨å•çº¿ç¨‹ä¸‹ï¼Œå¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œä¿®æ”¹çš„è¯ä¹Ÿä¼šè§¦å‘ fail-fast æœºåˆ¶ã€‚

å› ä¸ºå½“è¿­ä»£å™¨ä½¿ç”¨ `hashNext()` æˆ– `next()` éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ modCount å˜é‡æ˜¯å¦ä¸º expectedModCount å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚å¦‚æœåœ¨é›†åˆéå†æœŸé—´å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå°±ä¼šæ”¹å˜ modCount çš„å€¼ï¼Œè¿›è€Œå¯¼è‡´ modCount != exceptedModCOuntï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚

é˜¿é‡Œå·´å·´æ‰‹å†Œè§„å®šä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚è¦åˆ é™¤å…ƒç´ æ—¶ä½¿ç”¨ Iterator çš„ remove æ–¹æ³•ã€‚å¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ Iterator å¯¹è±¡åŠ é”ã€‚
