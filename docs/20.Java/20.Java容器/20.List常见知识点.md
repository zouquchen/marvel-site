---
title: Listå¸¸è§çŸ¥è¯†ç‚¹
date: 2022-07-13 16:28:42
permalink: /pages/db1d18/
categories:
  - Java
  - Javaå®¹å™¨
tags:
  - 
author: 
  name: Marvel
  link: https://github.com/zouquchen
---
# Listå¸¸è§çŸ¥è¯†ç‚¹

## ArrayListå’ŒVectorçš„åŒºåˆ«ï¼Ÿ

- ArrayListæ˜¯Listçš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨Object[]å­˜å‚¨ï¼Œé€‚åˆäºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ã€‚
- Vectoræ˜¯Listçš„å¤è€å®ç°ç±»ï¼Œåœ°åŸä½¿ç”¨Object[]å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ã€‚

## ArrayListå’ŒLinkedListåŒºåˆ«?

- çº¿ç¨‹å®‰å…¨ï¼šéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚
- åº•å±‚æ•°æ®ç»“æ„ï¼šArrayListä½¿ç”¨çš„æ˜¯Objectæ•°ç»„ï¼›LinkedListä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨
- æ’å…¥å’Œåˆ é™¤ï¼šArrayListæ’å…¥å’Œåˆ é™¤æ…¢ï¼ŒLinkedListæ’å…¥å’Œåˆ é™¤å¿«ã€‚
- éšæœºè®¿é—®ï¼šArrayListæ”¯æŒéšæœºè®¿é—®ï¼ŒLInkedListä¸æ”¯æŒ
- å†…å­˜å ç”¨ï¼šLinkedLisstå ç”¨ç©ºé—´å¤šä½™ArrayList

## Vectorå’ŒCopyOnWriteArrayListåŒºåˆ«ï¼Ÿ

- éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåº•å±‚å®ç°éƒ½æ˜¯æ•°ç»„ã€‚
- Vectorçš„æ¯ä¸ªæ–¹æ³•éƒ½è¿›è¡Œäº†åŠ é€Ÿã€‚
- CopyOnWriteArrayListçš„è¯»æ“ä½œä¸åŠ é”ï¼Œæ€§èƒ½ç”±äºVectorã€‚
- CopyOnWriteArrayListçš„å†™æ“ä½œï¼šåŠ é”ã€å¤åˆ¶æ•°ç»„ã€æ·»åŠ å…ƒç´ åˆ°å¤åˆ¶æ•°ç»„ã€æŒ‡å‘æ–°æ•°ç»„ã€è§£é”

## ArrayListçš„å¹¶å‘å¼‚å¸¸ï¼Ÿ

âŒ¨ **è¿è¡Œä»¥ä¸‹ä»£ç **

```java
public class ArrayListJucTest {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        for (int i = 0; i < 30; i++) {
            new Thread(() -> {
                list.add(UUID.randomUUID().toString().substring(0, 8));
                System.out.println(list);
            }, String.valueOf(i)).start();
        }
    }
}

```

ğŸ—‘ **å‡ºç°å¼‚å¸¸**ï¼šå¹¶å‘ä¿®æ”¹å¼‚å¸¸

```java
java.util.ConcurrentModificationException
```

ğŸ“£ **å¯¼è‡´åŸå› **

å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰

ğŸ· **è§£å†³æ–¹æ¡ˆ**

1 ä½¿ç”¨Vectorï¼ˆè¿œå¤å®ç°ç±»ï¼Œä¸æ¨èï¼‰

```java
List<String> list = new Vector<>();
```

2 ä½¿ç”¨çº¿ç¨‹å®‰å…¨å·¥å…·ç±»

```java
List<String> list = Collections.synchronizedList(new ArrayList<>());
```

3 ä½¿ç”¨CopyOnWriteArrayListï¼ˆå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼‰

```java
List<String> list = new CopyOnWriteArrayList<>();
```

## ä»€ä¹ˆæ˜¯å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰ï¼Ÿ

æ˜¯Javaé›†åˆçš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚åœ¨ä½¿ç”¨è¿­ä»£å™¨å¯¹é›†åˆè¿›è¡Œéå†çš„æ—¶å€™ï¼Œåœ¨å¤šçº¿ç¨‹æ“ä½œä¸‹ï¼Œé›†åˆå¯èƒ½ä¼šè§¦å‘fail-fastæœºåˆ¶ï¼Œå¯¼è‡´æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼›åœ¨å•çº¿ç¨‹ä¸‹ï¼Œå¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œä¿®æ”¹çš„è¯ä¹Ÿä¼šè§¦å‘fail-fastæœºåˆ¶ã€‚

å› ä¸ºå½“è¿­ä»£å™¨ä½¿ç”¨hashNext()æˆ–next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹modCountå˜é‡æ˜¯å¦ä¸ºexpectedModCountå€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚å¦‚æœåœ¨é›†åˆéå†æœŸé—´å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå°±ä¼šæ”¹å˜modCountçš„å€¼ï¼Œè¿›è€Œå¯¼è‡´modCount != exceptedModCOuntï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚

é˜¿é‡Œå·´å·´æ‰‹å†Œè§„å®šä¸è¦åœ¨foreachå¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„remove/addæ“ä½œã€‚è¦åˆ é™¤å…ƒç´ æ—¶ä½¿ç”¨Iteratorçš„removeæ–¹æ³•ã€‚å¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹Iteratorå¯¹è±¡åŠ é”ã€‚

## CopyOnWrite å†™æ—¶å¤åˆ¶æŠ€æœ¯

CopyOnWriteç®€ç§°COWã€‚æ„æ€å°±æ˜¯å¤§å®¶å…±åŒå»è®¿é—®ä¸€ä¸ªèµ„æºï¼Œå¦‚æœæœ‰äººæƒ³è¦å»ä¿®æ”¹è¿™ä¸ªèµ„æºçš„æ—¶å€™ï¼Œå°±éœ€è¦å¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ï¼Œå»ä¿®æ”¹è¿™ä¸ªå‰¯æœ¬ï¼Œè€Œå¯¹äºå…¶ä»–äººæ¥è¯´è®¿é—®å¾—èµ„æºè¿˜æ˜¯åŸæ¥çš„ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨hashcodeï¼Ÿ

hashcodeæ˜¯Objectçš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨HashMapä¸­å­˜å‚¨ä½¿ç”¨ï¼ŒHashMapæŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œæ ¹æ®keyçš„hashcodeå€¼ç”Ÿæˆæ•°ç»„ä¸‹æ ‡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚

åœ¨hashè¡¨ä¸­æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œé¦–å…ˆä¼šæ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰çš„è¯å†ç”¨equals()è¿›è¡Œæ¯”è¾ƒã€‚

åœ¨JDKä¸­ï¼ŒObjectçš„hashcodeæ–¹æ³•æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨c/c++å®ç°çš„ï¼Œç›´æ¥è¿”å›å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥é‡å†™hashcodeæ–¹æ³•æ˜¯ååˆ†é‡è¦çš„ã€‚

åœ¨Stringä¸­ï¼Œè®¡ç®—æ–¹æ³•ä¸ºï¼š`val[0]*31^(n-1) + val[1]*31^(n-2) + ... + val[n-1]`ï¼Œå­—ç¬¦ä¸²ä¸€æ ·çš„Stringå¯¹è±¡hashcodeä¹Ÿä¸€æ ·ã€‚

> ä½¿ç”¨31çš„åŸå› ï¼Ÿ
>
> - 31æ˜¯ä¸å¤§ä¸å°çš„è´¨æ•°ï¼Œé€‰æ‹©è´¨æ•°æ˜¯ä¸ºäº†é™ä½å“ˆå¸Œç®—æ³•çš„å“ˆå¸Œå†²çªã€‚
> - 31å¯è¢«JVMä¼˜åŒ–ï¼š`31 * i = (i << 5) - i`

## comparableå’ŒComparatoråŒºåˆ«ï¼Ÿ

- **è‡ªç„¶æ’åº**ï¼šcomparableæ¥å£å‡ºè‡ªjava.langåŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªcompareTo(Object obj)æ–¹æ³•ç”¨æ¥æ’åºã€‚åƒStringï¼ŒåŒ…è£…ç±»ç­‰å®ç°äº†Comparableæ¥å£ï¼Œé‡å†™äº†compareTo()æ–¹æ³•ã€‚å¯¹äºè‡ªå®šä¹‰ç±»ï¼Œå¦‚æœéœ€è¦æ’åºçš„è¯ï¼Œå¯ä»¥è®©è‡ªå®šä¹‰ç±»å®ç°Comparableæ¥å£ï¼Œåœ¨compareTo()æ–¹æ³•ä¸­æŒ‡æ˜å¦‚ä½•æ’åºã€‚

  > é‡å†™compareTo(obj)è§„åˆ™ï¼š
  >
  > å¦‚æœå½“å‰å¯¹è±¡this  > å½¢å‚å¯¹è±¡objï¼Œè¿”å›æ­£æ•´æ•°ã€‚
  >
  > å¦‚æœå½“å‰å¯¹è±¡this  < å½¢å‚å¯¹è±¡objï¼Œè¿”å›è´Ÿæ•´æ•°ã€‚
  >
  > å¦‚æœå½“å‰å¯¹è±¡this  = å½¢å‚å¯¹è±¡objï¼Œè¿”å›é›¶ã€‚

- **å®šåˆ¶æ’åº**ï¼šcomparatoræ¥å£å‡ºè‡ª java.utilåŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªcompare(Object obj1, Object obj2)æ–¹æ³•ç”¨æ¥æ’åºã€‚å½“å…ƒç´ çš„ç±»å‹æ²¡æœ‰å®ç°Comparableæ¥å£åˆä¸æ–¹ä¾¿ä¿®æ”¹æ—¶ï¼Œæˆ–è€…å®ç°äº†Comparebleæ¥å£çš„æ’åºè§„åˆ™ä¸é€‚åˆå½“å‰çš„æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Comparatorå¯¹è±¡æ¥æ’åºã€‚é‡å†™compare(Object o1, Object o2)ã€‚å¯ä»¥å°†Comparatorä¼ é€’ç»™sortæ–¹æ³•ï¼ˆå¦‚Collections.sortå’ŒArrays.sortï¼‰ã€‚

  <img src="https://raw.githubusercontent.com/zouquchen/Images/main/imgs/sort_test3.png" alt="image-20220311143132968" style="zoom:50%;" />

- æ¯”è¾ƒï¼šComparableç›¸å½“äºå†…éƒ¨æ¯”è¾ƒå™¨ï¼ŒComparatorç›¸å½“äºå¤–éƒ¨æ¯”è¾ƒå™¨ã€‚ä½¿ç”¨Comparableéœ€è¦ä¿®æ”¹æºç ï¼›ä½¿ç”¨Comparatorä¸éœ€è¦ä¿®æ”¹æºç ï¼Œè€Œæ˜¯å¦å¤–å®ç°æ¯”è¾ƒã€‚