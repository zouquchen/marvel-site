---
title: JVMå‚æ•°è®¾ç½®
date: 2022-07-13 18:31:43
permalink: /pages/cf43d5/
categories:
  - Java
  - Javaè™šæ‹Ÿæœº
tags:
  - Java
  - JVM
author: 
  name: Marvel
  link: https://github.com/zouquchen
---
# JVMå‚æ•°è®¾ç½®

#### 1 ä¸€äº›å‘½ä»¤

ğŸ“Œ **jpsï¼šæŸ¥çœ‹javaåå°è¿›ç¨‹**

è¾“å…¥å‘½ä»¤ï¼š`jps -l`

æ§åˆ¶å°è¾“å‡ºï¼š

```
14416 sun.tools.jps.Jps
14964
18388 test.HelloGC
15500 org.jetbrains.idea.maven.server.RemoteMavenServer36
```

ğŸ“Œ **jinfoï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œjavaç¨‹åºçš„å„ç§ä¿¡æ¯**

å‘½ä»¤ï¼š`jinfo -flag é…ç½®é¡¹ è¿›ç¨‹ç¼–å·` ã€`jinfo -flags è¿›ç¨‹ç¼–å·`

è¾“å…¥å‘½ä»¤ï¼š`jinfo -flag PrintGCDetails 13632 `

è§£é‡Šï¼šæŸ¥çœ‹13632 Javaè¿›ç¨‹æ˜¯å¦å¼€å¯`PrintGCDetails`

æ§åˆ¶å°è¾“å‡ºï¼š

```
-XX:-PrintGCDetails
```

è¾“å…¥å‘½ä»¤ï¼š`jinfo -flags 13632 `

è§£é‡Šï¼šæŸ¥çœ‹13632 Javaè¿›ç¨‹æ‰€æœ‰å‚æ•°çš„å€¼

æ§åˆ¶å°è¾“å‡ºï¼š

```
Attaching to process ID 13632, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.321-b07
Non-default VM flags: -XX:CICompilerCount=4 -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=4284481536 -XX:MaxNewSize=1428160512 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=89128960 -XX:OldSize=179306496 -XX:+PrintGCDetails -XX:+UseCompr
essedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
Command line:  -XX:+PrintGCDetails -javaagent:D:\Program Files\JetBrains\IntelliJ IDEA 2021.1.2\lib\idea_rt.jar=59267:D:\Program Files\JetBrains\IntelliJ IDEA 2021.1.2\bin -Dfile.encoding=UTF-8
```

è¯´æ˜ï¼š

Non-default VM flagsï¼šç³»ç»Ÿé»˜è®¤çš„å‚æ•°

Command lineï¼šäººä¸ºä¿®æ”¹çš„

ğŸ“Œ **è®¾ç½®JVMå‚æ•°**

èœå•æ Runâ€”â€”Edit Configurations ï¼ˆè‹¥æ²¡æœ‰ï¼Œå¯ä»¥åŒModify optionsè°ƒå‡ºæ¥ï¼‰

![image-20220619201231990](https://raw.githubusercontent.com/zouquchen/Images/main/imgs/image-20220619201231990-165581411314113.png)

ğŸ“Œ **æŸ¥çœ‹JVMé»˜è®¤å€¼çš„æ–¹æ³•**

1 ä½¿ç”¨jpså‘½ä»¤æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹

2 ä½¿ç”¨jinfoå‘½ä»¤æŸ¥çœ‹å…·ä½“çº¿ç¨‹æŸä¸€å‚æ•°çš„å€¼



#### 2 JVMçš„å‚æ•°ç±»å‹

> javaä»£ç åˆ°è¿è¡Œï¼šå…ˆç”¨javacç¼–è¯‘ï¼Œå†javaè¿è¡Œã€‚

ğŸ’ **æ ‡é…å‚æ•°**

```
java -version
Java -help
java -showversion
```

ğŸ’ **xå‚æ•°ï¼ˆäº†è§£ï¼‰**

```
-Xint è§£é‡Šæ‰§è¡Œ
-Xcomp ç¬¬ä¸€æ¬¡ä½¿ç”¨å°±ç¼–è¯‘æˆæœ¬åœ°ä»£ç 
-Xmixed æ··åˆæ¨¡å¼ï¼ˆå…ˆç¼–è¯‘ï¼Œå†æ‰§è¡Œï¼‰
```

ğŸ’ **xxå‚æ•°ï¼ˆé‡ç‚¹ï¼‰**

âš™ **booleanç±»å‹**

**å…¬å¼**ï¼š`-XX:+ æˆ–è€… - æŸä¸ªå±æ€§å€¼`; `+` è¡¨ç¤ºå¼€å¯ï¼› `-`è¡¨ç¤ºå…³é—­

**æ¡ˆä¾‹**ï¼š

> æŸ¥çœ‹13632è¿›ç¨‹æ˜¯å¦å¼€å¯`PrintGCDetails`
>
> è¾“å…¥ï¼š`jinfo -flag PrintGCDetails 13632`
>
> è¾“å‡ºï¼š`-XX:-PrintGCDetails `  è¡¨ç¤ºæ²¡æœ‰å¼€å¯
>
> è®¾ç½®å¼€å¯çš„æ–¹æ³•ï¼šè®¾ç½®VMå‚æ•°`-XX:+PrintGCDetails`

**å‚æ•°æ¡ˆä¾‹**ï¼š

> **æ˜¯å¦æ‰“å°GCæ”¶é›†ç»†èŠ‚**
>
> ä½¿ç”¨ï¼š`-XX:-PrintGCDetails`
>
> ä¸ä½¿ç”¨ï¼š`-XX:+PrintGCDetails`
>
> **æ˜¯å¦ä½¿ç”¨ä¸²è¡Œåƒåœ¾å›æ”¶å™¨**
>
> ä½¿ç”¨ï¼š`-XX:-UseSerialGC`
>
> ä¸ä½¿ç”¨ï¼š`-XX:+UseSerialGC`



âš™ **KVæ•°å€¼ç±»å‹**

**å…¬å¼**ï¼š`-XX:å±æ€§key=å±æ€§å€¼value`

**æ¡ˆä¾‹**ï¼š

> æŸ¥çœ‹Javaçº¿ç¨‹8576å…ƒç©ºé—´å¤§å°ï¼š`jinfo -flag MetaspaceSize 8576`
> è¾“å‡ºï¼š`-XX:MetaspaceSize=21807104`ï¼Œå…ƒç©ºé—´é»˜è®¤å¤§å°21MB

**å‚æ•°æ¡ˆä¾‹**ï¼š

> è®¾ç½®å…ƒç©ºé—´å¤§å°ï¼š`-XX:MetaspaceSize=128m`
>
> å‡çº§åˆ°è€å¹´åŒºçš„é˜ˆå€¼ï¼š`-XX:MaxTenuringThreshold=15`



####  3 ç»å…¸å‚æ•°-Xmsã€-Xmx

ğŸ”‘ `-Xms`ç­‰ä»·äº`-XX:InitialHeapSize`

è¡¨ç¤ºåˆå§‹åŒ–å †å¤§å°ï¼Œä¸€æ—¦å¯¹è±¡å®¹é‡è¶…è¿‡å †çš„åˆå§‹å®¹é‡ï¼ŒJAVAå †ä¼šè‡ªåŠ¨æ‰©å®¹åˆ°-Xmxå¤§å°ã€‚

é»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1/64

ğŸ”‘ `-Xmx`ç­‰ä»·äº`-XX:MaxHeapSize`

è¡¨ç¤ºå †å¯ä»¥æ‰©å±•åˆ°çš„æœ€å¤§å€¼ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé€šå¸¸å°†-Xmså’Œ-Xmxè®¾ç½®æˆä¸€æ ·çš„ï¼Œå› ä¸ºå½“å †ä¸å¤Ÿç”¨è€Œå‘ç”Ÿæ‰©å®¹æ—¶ï¼Œä¼šå‘ç”Ÿå†…å­˜æŠ–åŠ¨å½±å“ç¨‹åºè¿è¡Œæ—¶çš„ç¨³å®šæ€§ã€‚

é»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1/4



> å…ƒç©ºé—´å¤§å°é»˜è®¤å€¼ä¸ºæœ¬åœ°å†…å­˜çš„1/4



âŒ¨ é€šè¿‡ç¨‹åºè·å¾—å‚æ•°å€¼

```java
public static void main(String[] args) throws InterruptedException {
    // Javaè™šæ‹Ÿæœºå†…å­˜æ€»é‡
    long totalMemory = Runtime.getRuntime().totalMemory();
    // javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜
    long maxMemory = Runtime.getRuntime().maxMemory();

    System.out.println("TOTAL_MEMORY(-Xms) = " + totalMemory + " ï¼ˆå­—èŠ‚ï¼‰ã€" + (totalMemory / (double) 1024 / 1024) + "MB");
    System.out.println("MAX_MEMORY(-Xmx) = " + maxMemory + " ï¼ˆå­—èŠ‚ï¼‰ã€" + (maxMemory / (double) 1024 / 1024) + "MB");
}
```



#### 4 ç»å…¸å‚æ•° -Xss

ç­‰ä»·äº`-XX:ThreadStackSize`

è®¾ç½®æ–¹æ³•ï¼š`-Xss128k`

è®¾ç½®å•ä¸ªçº¿ç¨‹æ ˆçš„å¤§å°ï¼Œä¸€èˆ¬é»˜è®¤å€¼ä¸º512k~1024k



#### 5 ç»å…¸å‚æ•° -Xmn

è®¾ç½®å¹´è½»ä»£å¤§å°



#### 6 ç»å…¸å‚æ•° -XX:MetaspaceSize

è®¾ç½®å…ƒç©ºé—´å¤§å°

> å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å †JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚
>
> åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸å†è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚



#### 7 ç»å…¸å‚æ•° -XX:+PrintGCDetails

è¾“å‡ºè¯¦ç»†GCæ”¶é›†æ—¥å¿—ä¿¡æ¯



Yong GC æ¡ˆä¾‹

![image-20220620215952170](https://raw.githubusercontent.com/zouquchen/Images/main/imgs/image-20220620215952170.png)



Full GC æ¡ˆä¾‹

![image-20220620220513101](https://raw.githubusercontent.com/zouquchen/Images/main/imgs/image-20220620220513101.png)

è§„å¾‹ï¼šGCå‰å†…å­˜å ç”¨->GCåå†…å­˜å ç”¨ ï¼ˆè¯¥å†…å­˜æ€»å¤§å°ï¼‰



#### 8 ç»å…¸å‚æ•° -XX:SurvivorRatio

è®¾ç½®æ–°ç”Ÿä»£ä¸­eden/S0/S1ç©ºé—´çš„æ¯”ä¾‹ï¼ŒSurvivorRatioå€¼å°±æ˜¯è®¾ç½®edenåŒºçš„æ¯”ä¾‹å å¤šå°‘ï¼ŒS0/S1ç›¸åŒ

é»˜è®¤ï¼š-XX:SurvivorRatio=8,    Eden:S0:S1 = 8:1:1

è®¾ç½®ï¼š-XX:SurvivorRatio=4,    Eden:S0:S1 = 4:1:1

![image-20220620220935477](https://raw.githubusercontent.com/zouquchen/Images/main/imgs/image-20220620220935477.png)



#### 9 ç»å…¸å‚æ•° -XX:NewRatio

é…ç½®å¹´è½»ä»£å’Œè€å¹´ä»£å†å †ç»“æ„çš„å æ¯”

é»˜è®¤ï¼š-XX:NewRatio=2           æ–°ç”Ÿä»£ï¼šè€å¹´ä»£=1ï¼š2

è®¾ç½®ï¼š-xx:NewRatio=4           æ–°ç”Ÿä»£ï¼šè€å¹´ä»£=1ï¼š4



#### 10 ç»å…¸å‚æ•° -XX:MaxTenuringThreshold

åƒåœ¾è¿›å…¥è€å¹´ä»£çš„å¹´é¾„

é»˜è®¤ï¼š-XX:MaxTenuringThreshold=15

è®¾ç½®ï¼š-XX:MaxTenuringThreshold=12

æ³¨æ„ï¼šèŒƒå›´ä¸º0~15ï¼Œå› ä¸ºå¯¹è±¡å¤´åªæœ‰4ä½ç”¨äºå­˜å‚¨å¹´é¾„ï¼Œæœ€å¤§å€¼ä¸º1111b

![image-20220620222235303](https://raw.githubusercontent.com/zouquchen/Images/main/imgs/image-20220620222235303.png)



#### 11 ç»å…¸è®¾ç½®æ¡ˆä¾‹

```
-Xms128m -Xmx4096m -Xss1024k -XX:MetaspaceSize=512m -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseSerialGC
```



#### 12 ç›˜ç‚¹JVMé»˜è®¤å€¼

ğŸ” **æŸ¥çœ‹åˆå§‹å€¼**ï¼š`java -XX:+PrintFlagsInitial`

```
E:\java\code\studyNote\java\target\classes\lsq>java -XX:+PrintFlagsInitial
[Global flags]
     intx ActiveProcessorCount                      = -1                                  {product}
    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   {product}
    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  {product}
    uintx AdaptiveSizePausePolicy                   = 0                                   {product}
    uintx AdaptiveSizePolicyCollectionCostMargin    = 50                                  {product}
    uintx AdaptiveSizePolicyInitializingSteps       = 20                                  {product}
    uintx AdaptiveSizePolicyOutputInterval          = 0                                   {product}
    uintx AdaptiveSizePolicyWeight                  = 10                                  {product}
    uintx AdaptiveSizeThroughPutPolicy              = 0                                   {product}
    uintx AdaptiveTimeWeight                        = 25                                  {product}
     bool AdjustConcurrency                         = false                               {product}
     bool AggressiveHeap                            = false                               {product}
     bool AggressiveOpts                            = false                               {product}
	...
```

`=`ï¼šè¡¨ç¤ºJVMé»˜è®¤åŠ è½½çš„å€¼

æŸ¥çœ‹ä¿®æ”¹æ›´æ–°ï¼š`java -XX:+PrintFlagsFinal`

`:=`ï¼šè¡¨ç¤ºä¿®æ”¹è¿‡çš„å€¼ï¼ˆJVMè‡ªå·±ä¿®æ”¹æˆ–æ˜¯è®¤ä¸ºä¿®æ”¹ï¼‰



ğŸ” è®¾ç½®å±æ€§è¿è¡ŒJavaä»£ç ï¼Œå¹¶æŸ¥çœ‹jvmå±æ€§å€¼ï¼š

`java -XX:+PrintFlagsFinal -Xms128k javaç¨‹åº`



ğŸ” æŸ¥çœ‹é»˜è®¤å€¼ï¼š`java -XX:+PrintCommandLineFlags -version`

è¾“å‡ºï¼š

```
-XX:InitialHeapSize=267755904 -XX:MaxHeapSize=4284094464 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
java version "1.8.0_321"
Java(TM) SE Runtime Environment (build 1.8.0_321-b07)
Java HotSpot(TM) 64-Bit Server VM (build 25.321-b07, mixed mode)
```

å¯ä»¥æŸ¥çœ‹åˆ°å †çš„å¤§å°ã€é»˜è®¤åƒåœ¾å›æ”¶å™¨ç­‰ã€‚